
%%%%%ATTENZIONE si usa sempre valoreToBot(Tot). è un errore? yes, corretto


%Data la proposta di uno scambio, si accetta o si rifiuta
accetto | rifiuto.

%Calcolo il valore totale che ricevo (prezzo vendita caselle + soldi)
netto1(Netto) :- Netto = #sum{Prezzo, X:casella(X,_,_,Prezzo,_,_,false), casellaToBot(X)}.
netto2(Netto) :- Netto = #sum{Prezzo, X:casella(X,_,_,Prezzo,_,_,true), casellaToBot(X)}.
netto3(Tot) :- netto1(X), netto2(Y), Tot = X+Y.
valoreToBot(Tot) :- netto3(X), soldiToBot(Y), Tot = X+Y.

%Calcolo il valore totale che do:
netto4(Netto) :- Netto = #sum{Prezzo, X:casella(X,_,_,Prezzo,_,_,false), casellaToYou(X)}.
netto5(Netto) :- Netto = #sum{Prezzo, X:casella(X,_,_,Prezzo,_,_,true), casellaToYou(X)}.
netto6(Tot) :- netto4(X), netto5(Y), Tot = X+Y.
valoreToYou(Tot) :- netto6(X), soldiToYou(Y), Tot = X+Y.

%Sono incentivato ad accettare se la differenza tra i due valori è positiva
:~ rifiuto, valoreToBot(X), valoreToYou(Y), X > Y. [1:2]

%Sono molto incentivato ad accettare se la differenza tra i due valori è alta
:~ rifiuto, valoreToBot(X), valoreToYou(Y), Z = X - Y, Z > 400. [1:3]
:~ rifiuto, valoreToBot(X), valoreToYou(Y), Z = X - Y, Z > 700. [1:3]
:~ rifiuto, valoreToBot(X), valoreToYou(Y), Z = X - Y, Z > 1000. [1:3]
:~ rifiuto, valoreToBot(X), valoreToYou(Y), Z = X - Y, Z > 1500. [1:3]

%Preferisco rifiutare se il giocatore corrente ha tutto il set dello stesso colore della casella richiesta
:~accetto, casella(Casella1,_,Colore,_,_,_,_),numeroMieCaselleStessoColore(Colore, Numero), Numero>2. [2:10]
:~accetto, casella(Casella1,_,Colore,_,_,_,_),numeroMieCaselleStessoColore(Colore, Numero), Numero>2. [2:10]


%numero delle caselle possedute dal giocatore corrente dello stesso colore
numeroMieCaselleStessoColore(Colore, Numero):- giocatore(Proprietario,_,_,_,_,_), casella(Casella, Proprietario,Colore,_,_,_,_),
	#count{ StessoColore, NomeCasella :casella(NomeCasella, Proprietario,StessoColore,_,_,_,_), StessoColore = Colore} = Numero.
%Preferisco accettare se completa il set di caselle dello stesso colore del giocatore corrente
:~rifiuto, casella(Casella2,_,Colore,_,_,_,_),numeroMieCaselleStessoColore(Colore, Numero), Numero>1. [1:9]


%Preferisco accettare se la casella è ipotecata
:~rifiuto(Proposta), scambio(Proposta, Casella1, Casella2),casella(Casella1,_,_,_,_,_,Ipotecata1), Ipotecata1=true, 
	casella(Casella2,_,_,_,_,_,Ipotecata2), Ipotecata2=false. [1:8]
:~rifiuto(Proposta), acquisto(Proposta, Casella1, Soldi),casella(Casella1,_,_,_,_,_,Ipotecata), Ipotecata=true, Soldi>100. [1:8]

%Prefersico non accettare lo scambio se la casella avversaria da prendere è ipotecata
:~accetto(Proposta), scambio(Proposta,_,Casella2), casella(Casella2,_,_,_,_,_,Ipotecata), Ipotecata=true. [2:8]


%Numero delle caselle possedute dall avversario dello stesso colore
numeroCaselleStessoColoreAvversario(Colore, Numero):- avversario(Proprietario,_,_,_,_,_), casella(Casella, Proprietario,Colore,_,_,_,_),
    #count{ StessoColore, NomeCasella :casella(NomeCasella, Proprietario,StessoColore,_,_,_,_),	StessoColore = Colore} = Numero.
%Preferirei non accettare se completa il set di colore avversario
:~accetto(Proposta), scambio(Proposta, Casella1,_), casella(Casella1,_,Colore,_,_,_,_), numeroCaselleStessoColoreAvversario(Colore, Numero), Numero>1. [1:7]
:~accetto(Proposta), acquisto(Proposta, Casella1,_), casella(Casella1,_,Colore,_,_,_,_), numeroCaselleStessoColoreAvversario(Colore, Numero), Numero>1. [1:7]


%Preferisco rifiutare se i soldi sono minori del prezzo di vendita della casella
:~accetto(Proposta), acquisto(Proposta, Casella1, Soldi), casella(Casella1,_,Colore,PrezzoVendita,_,_,_), Soldi<PrezzoVendita. [1:6]


%Preferisco accettare se la mia casella ha prezzo di transito basso
:~rifiuto(Proposta), scambio(Proposta, Casella1, _), casella(Casella1,_,_,_,PrezzoTansito,_,_), PrezzoTansito<100. [2:5]
:~rifiuto(Proposta), acquisto(Proposta, Casella1, _), casella(Casella1,_,_,_,PrezzoTansito,_,_), PrezzoTansito<100. [2:5]


%Preferisco rifiutare lo scambio se la mia casella ha prezzo di transito superiore di quella avversaria da prendere
:~accetto(Proposta), scambio(Proposta, Casella1, Casella2), casella(Casella1,_,_,_,PrezzoTansito1,_,_), casella(Casella2,_,_,_,PrezzoTansito2,_,_),
	PrezzoTansito2<PrezzoTansito1. [1:5]

%Preferirei rifiutare
:~accetto(Proposta). [1:1]
